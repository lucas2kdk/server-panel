{% extends "base.html" %}

{% block title %}{{ server.name }} - Server Panel{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <div class="mb-6">
        <a href="{{ url_for('servers.dashboard') }}" class="text-blue-600 hover:text-blue-700">
            &larr; Back to Dashboard
        </a>
    </div>

    <div class="bg-white rounded-lg shadow-lg p-8 mb-6">
        <div class="flex justify-between items-start mb-6">
            <div>
                <h2 class="text-3xl font-bold text-gray-800 mb-2">{{ server.name }}</h2>
                <p class="text-gray-600">{{ server.server_type | capitalize }} {{ server.server_version }}</p>
            </div>
            <span class="px-4 py-2 rounded-full text-sm font-semibold
                {% if server.status == 'running' %}bg-green-100 text-green-800
                {% elif server.status == 'starting' %}bg-yellow-100 text-yellow-800
                {% elif server.status == 'stopped' %}bg-gray-100 text-gray-800
                {% elif server.status == 'error' %}bg-red-100 text-red-800
                {% else %}bg-blue-100 text-blue-800{% endif %}">
                {{ server.status | capitalize }}
            </span>
        </div>

        <!-- Server Controls -->
        <div class="flex space-x-3 mb-6">
            {% if server.status == 'stopped' or server.status == 'error' %}
            <button onclick="controlServer('start')" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded transition">
                Start Server
            </button>
            {% elif server.status == 'running' %}
            <button onclick="controlServer('stop')" class="bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-2 rounded transition">
                Stop Server
            </button>
            <button onclick="controlServer('restart')" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded transition">
                Restart Server
            </button>
            {% endif %}

            <a href="{{ url_for('console.view', server_id=server.id) }}" class="bg-gray-700 hover:bg-gray-800 text-white px-6 py-2 rounded transition inline-block">
                Console
            </a>

            <a href="{{ url_for('files.browser', server_id=server.id) }}" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded transition inline-block">
                Files
            </a>

            <button onclick="deleteServer()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded transition ml-auto">
                Delete Server
            </button>
        </div>

        <!-- Server Information -->
        <div class="grid md:grid-cols-2 gap-6">
            <div>
                <h3 class="text-lg font-bold text-gray-800 mb-3">Server Information</h3>
                <dl class="space-y-2">
                    <div class="flex justify-between">
                        <dt class="text-gray-600">Server ID:</dt>
                        <dd class="font-semibold">{{ server.id }}</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="text-gray-600">Created:</dt>
                        <dd class="font-semibold">{{ server.created_at.strftime('%Y-%m-%d %H:%M') }}</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="text-gray-600">Pod Name:</dt>
                        <dd class="font-semibold text-sm">{{ server.pod_name }}</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="text-gray-600">Service:</dt>
                        <dd class="font-semibold text-sm">{{ server.service_name }}</dd>
                    </div>
                </dl>
            </div>

            <div>
                <h3 class="text-lg font-bold text-gray-800 mb-3">Resource Allocation</h3>
                <dl class="space-y-2">
                    <div class="flex justify-between">
                        <dt class="text-gray-600">CPU Cores:</dt>
                        <dd class="font-semibold">{{ server.cpu_cores }}</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="text-gray-600">RAM:</dt>
                        <dd class="font-semibold">{{ (server.ram_mb / 1024) | round(1) }} GB</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="text-gray-600">Disk:</dt>
                        <dd class="font-semibold">{{ server.disk_gb }} GB</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="text-gray-600">Storage:</dt>
                        <dd class="font-semibold text-sm">{{ server.pvc_name }}</dd>
                    </div>
                </dl>
            </div>
        </div>
    </div>
</div>

<script>
function controlServer(action) {
    const confirmMessage = `Are you sure you want to ${action} this server?`;
    if (confirm(confirmMessage)) {
        fetch(`/servers/{{ server.id }}/${action}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                location.reload();
            } else {
                alert('Error: ' + (data.error || 'Unknown error'));
            }
        })
        .catch(error => {
            alert('Error: ' + error);
        });
    }
}

function deleteServer() {
    const serverName = "{{ server.name }}";
    if (confirm(`Are you sure you want to DELETE "${serverName}"? This action cannot be undone!`)) {
        if (confirm('This will permanently delete all server data. Type the server name to confirm.')) {
            fetch(`/servers/{{ server.id }}/delete`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    window.location.href = '/servers/dashboard';
                } else {
                    alert('Error: ' + (data.error || 'Unknown error'));
                }
            })
            .catch(error => {
                alert('Error: ' + error);
            });
        }
    }
}
</script>
{% endblock %}
